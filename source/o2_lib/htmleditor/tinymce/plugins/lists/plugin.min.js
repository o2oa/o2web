tinymce.PluginManager.add("lists",function(e){var t=this;function n(e){return e&&/^(OL|UL)$/.test(e.nodeName)}function r(e){return e.parentNode.firstChild==e}function i(e){return e.parentNode.lastChild==e}function a(t){return t&&!!e.schema.getTextBlockElements()[t.nodeName]}function o(e){return e&&e.nodeName==="SPAN"&&e.getAttribute("data-mce-type")==="bookmark"}e.on("init",function(){var d=e.dom,f=e.selection;function s(e){var t={};function n(n){var r,i,a;i=e[n?"startContainer":"endContainer"];a=e[n?"startOffset":"endOffset"];if(i.nodeType==1){r=d.create("span",{"data-mce-type":"bookmark"});if(i.hasChildNodes()){a=Math.min(a,i.childNodes.length-1);if(n){i.insertBefore(r,i.childNodes[a])}else{d.insertAfter(r,i.childNodes[a])}}else{i.appendChild(r)}i=r;a=0}t[n?"startContainer":"endContainer"]=i;t[n?"startOffset":"endOffset"]=a}n(true);if(!e.collapsed){n()}return t}function l(e){function t(t){var n,r,i;function a(e){var t=e.parentNode.firstChild,n=0;while(t){if(t==e){return n}if(t.nodeType!=1||t.getAttribute("data-mce-type")!="bookmark"){n++}t=t.nextSibling}return-1}n=i=e[t?"startContainer":"endContainer"];r=e[t?"startOffset":"endOffset"];if(!n){return}if(n.nodeType==1){r=a(n);n=n.parentNode;d.remove(i)}e[t?"startContainer":"endContainer"]=n;e[t?"startOffset":"endOffset"]=r}t(true);t();var n=d.createRng();n.setStart(e.startContainer,e.startOffset);if(e.endContainer){n.setEnd(e.endContainer,e.endOffset)}f.setRng(n)}function u(t,n){var r,i,a=d.createFragment(),o;var f=e.schema.getBlockElements();if(e.settings.forced_root_block){n=n||e.settings.forced_root_block}if(n){i=d.create(n);if(i.tagName===e.settings.forced_root_block){d.setAttribs(i,e.settings.forced_root_block_attrs)}a.appendChild(i)}if(t){while(r=t.firstChild){var s=r.nodeName;if(!o&&(s!="SPAN"||r.getAttribute("data-mce-type")!="bookmark")){o=true}if(f[s]){a.appendChild(r);i=null}else{if(n){if(!i){i=d.create(n);a.appendChild(i)}i.appendChild(r)}else{a.appendChild(r)}}}}if(!e.settings.forced_root_block){a.appendChild(d.create("br"))}else{if(!o&&(!tinymce.Env.ie||tinymce.Env.ie>10)){i.appendChild(d.create("br",{"data-mce-bogus":"1"}))}}return a}function c(){return tinymce.grep(f.getSelectedBlocks(),function(e){return e.nodeName=="LI"})}function p(e,t,n){var r,i;var a=d.select('span[data-mce-type="bookmark"]',e);n=n||u(t);r=d.createRng();r.setStartAfter(t);r.setEndAfter(e);i=r.extractContents();if(!d.isEmpty(i)){d.insertAfter(i,e)}d.insertAfter(n,e);if(d.isEmpty(t.parentNode)){tinymce.each(a,function(e){t.parentNode.parentNode.insertBefore(e,t.parentNode)});d.remove(t.parentNode)}d.remove(t)}function m(e){var t,r;t=e.nextSibling;if(t&&n(t)&&t.nodeName==e.nodeName){while(r=t.firstChild){e.appendChild(r)}d.remove(t)}t=e.previousSibling;if(t&&n(t)&&t.nodeName==e.nodeName){while(r=t.firstChild){e.insertBefore(r,e.firstChild)}d.remove(t)}}function h(e){tinymce.each(tinymce.grep(d.select("ol,ul",e)),function(e){var t,r=e.parentNode;if(r.nodeName=="LI"&&r.firstChild==e){t=r.previousSibling;if(t&&t.nodeName=="LI"){t.appendChild(e);if(d.isEmpty(r)){d.remove(r)}}}if(n(r)){t=r.previousSibling;if(t&&t.nodeName=="LI"){t.appendChild(e)}}})}function v(e){var t=e.parentNode,a=t.parentNode,o;function f(e){if(d.isEmpty(e)){d.remove(e)}}if(r(e)&&i(e)){if(a.nodeName=="LI"){d.insertAfter(e,a);f(a);d.remove(t)}else if(n(a)){d.remove(t,true)}else{a.insertBefore(u(e),t);d.remove(t)}return true}else if(r(e)){if(a.nodeName=="LI"){d.insertAfter(e,a);e.appendChild(t);f(a)}else if(n(a)){a.insertBefore(e,t)}else{a.insertBefore(u(e),t);d.remove(e)}return true}else if(i(e)){if(a.nodeName=="LI"){d.insertAfter(e,a)}else if(n(a)){d.insertAfter(e,t)}else{d.insertAfter(u(e),t);d.remove(e)}return true}else{if(a.nodeName=="LI"){t=a;o=u(e,"LI")}else if(n(a)){o=u(e,"LI")}else{o=u(e)}p(t,e,o);h(t.parentNode);return true}return false}function C(e){var t,r;function i(t,r){var i;if(n(t)){while(i=e.lastChild.firstChild){r.appendChild(i)}d.remove(t)}}t=e.previousSibling;if(t&&n(t)){t.appendChild(e);return true}if(t&&t.nodeName=="LI"&&n(t.lastChild)){t.lastChild.appendChild(e);i(e.lastChild,t.lastChild);return true}t=e.nextSibling;if(t&&n(t)){t.insertBefore(e,t.firstChild);return true}if(t&&t.nodeName=="LI"&&n(e.lastChild)){return false}t=e.previousSibling;if(t&&t.nodeName=="LI"){r=d.create(e.parentNode.nodeName);t.appendChild(r);r.appendChild(e);i(e.lastChild,r);return true}return false}function g(){var t=c();if(t.length){var n=s(f.getRng(true));for(var r=0;r<t.length;r++){if(!C(t[r])&&r===0){break}}l(n);e.nodeChanged();return true}}function N(){var t=c();if(t.length){var n=s(f.getRng(true));var r,i,a=e.getBody();r=t.length;while(r--){var o=t[r].parentNode;while(o&&o!=a){i=t.length;while(i--){if(t[i]===o){t.splice(r,1);break}}o=o.parentNode}}for(r=0;r<t.length;r++){if(!v(t[r])&&r===0){break}}l(n);e.nodeChanged();return true}}function y(t){var r=f.getRng(true),i=s(r);function u(){var t=[],n=e.getBody();function i(e){var t,i;t=r[e?"startContainer":"endContainer"];i=r[e?"startOffset":"endOffset"];if(t.nodeType==1){t=t.childNodes[Math.min(i,t.childNodes.length-1)]||t}while(t.parentNode!=n){if(a(t)){return t}if(/^(TD|TH)$/.test(t.parentNode.nodeName)){return t}t=t.parentNode}return t}var f=i(true);var s=i();var l,u=[];for(var c=f;c;c=c.nextSibling){u.push(c);if(c==s){break}}tinymce.each(u,function(e){if(a(e)){t.push(e);l=null;return}if(d.isBlock(e)||e.nodeName=="BR"){if(e.nodeName=="BR"){d.remove(e)}l=null;return}var r=e.nextSibling;if(o(e)){if(a(r)||!r&&e.parentNode==n){l=null;return}}if(!l){l=d.create("p");e.parentNode.insertBefore(l,e);t.push(l)}l.appendChild(e)});return t}var c=u();tinymce.each(c,function(e){var r,i;i=e.previousSibling;if(i&&n(i)&&i.nodeName==t){r=i;e=d.rename(e,"LI");i.appendChild(e)}else{r=d.create(t);e.parentNode.insertBefore(r,e);r.appendChild(e);e=d.rename(e,"LI")}m(r)});l(i)}function b(){var t=s(f.getRng(true)),r=e.getBody();tinymce.each(c(),function(e){var t,i;if(d.isEmpty(e)){v(e);return}for(t=e;t&&t!=r;t=t.parentNode){if(n(t)){i=t}}p(i,e)});l(t)}function k(e){var t=d.getParent(f.getStart(),"OL,UL");if(t){if(t.nodeName==e){b(e)}else{var n=s(f.getRng(true));m(d.rename(t,e));l(n)}}else{y(e)}}t.backspaceDelete=function(e){function t(e,t){var n=e.startContainer,r=e.startOffset;if(n.nodeType==3&&(t?r<n.data.length:r>0)){return n}var i=new tinymce.dom.TreeWalker(e.startContainer);while(n=i[t?"next":"prev"]()){if(n.nodeType==3&&n.data.length>0){return n}}}function r(e,t){var r,i,a=e.parentNode;if(n(t.lastChild)){i=t.lastChild}r=t.lastChild;if(r&&r.nodeName=="BR"&&e.hasChildNodes()){d.remove(r)}while(r=e.firstChild){t.appendChild(r)}if(i){t.appendChild(i)}d.remove(e);if(d.isEmpty(a)){d.remove(a)}}if(f.isCollapsed()){var i=d.getParent(f.getStart(),"LI");if(i){var a=f.getRng(true);var o=d.getParent(t(a,e),"LI");if(o&&o!=i){var u=s(a);if(e){r(o,i)}else{r(i,o)}l(u);return true}else if(!o){if(!e&&b(i.parentNode.nodeName)){return true}}}}};e.addCommand("Indent",function(){if(!g()){return true}});e.addCommand("Outdent",function(){if(!N()){return true}});e.addCommand("InsertUnorderedList",function(){k("UL")});e.addCommand("InsertOrderedList",function(){k("OL")});e.on("keydown",function(t){if(t.keyCode==9&&e.dom.getParent(e.selection.getStart(),"LI")){t.preventDefault();if(t.shiftKey){N()}else{g()}}})});e.addButton("indent",{icon:"indent",title:"Increase indent",cmd:"Indent",onPostRender:function(){var t=this;e.on("nodechange",function(){var n=e.selection.getSelectedBlocks();var i=false;for(var a=0,o=n.length;!i&&a<o;a++){var d=n[a].nodeName;i=d=="LI"&&r(n[a])||d=="UL"||d=="OL"}t.disabled(i)})}});e.on("keydown",function(e){if(e.keyCode==tinymce.util.VK.BACKSPACE){if(t.backspaceDelete()){e.preventDefault()}}else if(e.keyCode==tinymce.util.VK.DELETE){if(t.backspaceDelete(true)){e.preventDefault()}}})});