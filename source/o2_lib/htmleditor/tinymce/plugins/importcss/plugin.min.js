tinymce.PluginManager.add("importcss",function(e){var t=this,i=tinymce.each;function r(e){if(typeof e=="string"){return function(t){return t.indexOf(e)!==-1}}else if(e instanceof RegExp){return function(t){return e.test(t)}}return e}function n(t,r){var n=[],s={};function c(e,t){var s=e.href,o;if(!s||!r(s,t)){return}i(e.imports,function(e){c(e,true)});try{o=e.cssRules||e.rules}catch(e){}i(o,function(e){if(e.styleSheet){c(e.styleSheet,true)}else if(e.selectorText){i(e.selectorText.split(","),function(e){n.push(tinymce.trim(e))})}})}i(e.contentCSS,function(e){s[e]=true});if(!r){r=function(e,t){return t||s[e]}}try{i(t.styleSheets,function(e){c(e)})}catch(e){}return n}function s(t){var i;var r=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(t);if(!r){return}var n=r[1];var s=r[2].substr(1).split(".").join(" ");var c=tinymce.makeMap("a,img");if(r[1]){i={title:t};if(e.schema.getTextBlockElements()[n]){i.block=n}else if(e.schema.getBlockElements()[n]||c[n.toLowerCase()]){i.selector=n}else{i.inline=n}}else if(r[2]){i={inline:"span",title:t.substr(1),classes:s}}if(e.settings.importcss_merge_classes!==false){i.classes=s}else{i.attributes={class:s}}return i}e.on("renderFormatsMenu",function(c){var o=e.settings,f={};var a=o.importcss_selector_converter||s;var l=r(o.importcss_selector_filter),u=c.control;if(!e.settings.importcss_append){u.items().remove()}var m=[];tinymce.each(o.importcss_groups,function(e){e=tinymce.extend({},e);e.filter=r(e.filter);m.push(e)});i(n(c.doc||e.getDoc(),r(o.importcss_file_filter)),function(i){if(i.indexOf(".mce-")===-1){if(!f[i]&&(!l||l(i))){var r=a.call(t,i),n;if(r){var s=r.name||tinymce.DOM.uniqueId();if(m){for(var c=0;c<m.length;c++){if(!m[c].filter||m[c].filter(i)){if(!m[c].item){m[c].item={text:m[c].title,menu:[]}}n=m[c].item.menu;break}}}e.formatter.register(s,r);var o=tinymce.extend({},u.settings.itemDefaults,{text:r.title,format:s});if(n){n.push(o)}else{u.add(o)}}f[i]=true}}});i(m,function(e){u.add(e.item)});c.control.renderNew()});t.convertSelectorToFormat=s});